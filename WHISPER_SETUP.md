# Whisper.cpp WASM Setup Guide

This guide explains how to build whisper.cpp for WebAssembly and integrate it into this project.

## Step 1: Build Whisper.cpp WASM

Navigate to your whisper.cpp directory and build the WASM version:

```bash
cd /path/to/whisper.cpp

# Install emscripten if you haven't already
# On macOS:
brew install emscripten

# On Linux:
# Follow: https://emscripten.org/docs/getting_started/downloads.html

# Build the WASM library
emcc -I. -O3 -s WASM=1 -s EXPORTED_RUNTIME_METHODS=["ccall","cwrap"] \
    -s ALLOW_MEMORY_GROWTH=1 -s MODULARIZE=1 -s EXPORT_NAME="createWhisperModule" \
    -s EXPORTED_FUNCTIONS='["_malloc","_free"]' \
    ggml.c whisper.cpp -o whisper.js
```

**Alternative: Use the provided build script in examples/whisper.wasm/**

```bash
cd whisper.cpp/examples/whisper.wasm

# Build using the provided script
bash build.sh
```

## Step 2: Locate the Generated Files

After building, you'll find these files:

### If you used the manual emcc command:
```
whisper.cpp/
├── whisper.js          # JavaScript wrapper (YOU NEED THIS)
└── whisper.wasm        # WebAssembly binary (YOU NEED THIS)
```

### If you used examples/whisper.wasm/build.sh:
```
whisper.cpp/examples/whisper.wasm/
├── whisper.js          # JavaScript wrapper (YOU NEED THIS)
└── whisper.wasm        # WebAssembly binary (YOU NEED THIS)
```

## Step 3: Copy Files to This Project

Copy the generated files to your project root:

```bash
# If built in whisper.cpp root:
cp /path/to/whisper.cpp/whisper.js /path/to/hello/
cp /path/to/whisper.cpp/whisper.wasm /path/to/hello/

# If built in examples/whisper.wasm:
cp /path/to/whisper.cpp/examples/whisper.wasm/whisper.js /path/to/hello/
cp /path/to/whisper.cpp/examples/whisper.wasm/whisper.wasm /path/to/hello/
```

Your project structure should look like:

```
hello/
├── index.html
├── whisper.js          # ← JavaScript wrapper
├── whisper.wasm        # ← WASM binary
├── ggml-tiny.en.bin    # ← Your model file
├── vosk-model-small-en-us-0.15.zip
├── js/
│   ├── core/
│   └── engines/
└── README.md
```

## Step 4: Update index.html

The whisper.js script is already referenced in index.html, but it's commented out. Uncomment it:

```html
<!-- Whisper.cpp WASM Library -->
<script src="whisper.js"></script>
```

## Step 5: Test the Setup

1. Start your local server:
   ```bash
   cd /path/to/hello
   python3 -m http.server 8080
   ```

2. Open `http://localhost:8080` in your browser

3. Open the browser console (F12)

4. Select "Whisper.cpp (High Accuracy)" from the engine dropdown

5. Check for any errors in the console

## Troubleshooting

### Error: "createWhisperModule is not defined"

This means `whisper.js` wasn't loaded correctly. Check:
- Is `whisper.js` in the project root?
- Is the `<script src="whisper.js"></script>` line uncommented in index.html?
- Did you refresh the page after adding the file?

### Error: "Failed to fetch whisper.wasm"

This means the WASM file can't be loaded. Check:
- Is `whisper.wasm` in the same directory as `whisper.js`?
- Are you using an HTTP server (not file://)?
- Check browser console for CORS errors

### Error: "Failed to fetch model"

This means the model file can't be loaded. Check:
- Is `ggml-tiny.en.bin` in the project root?
- Is the model URL correct in `js/core/app.js`?
- Check the browser network tab for the exact error

### Model is loading but transcription fails

- Whisper requires more memory than Vosk
- Try using a smaller model (tiny vs small)
- Close other browser tabs
- Check browser console for memory errors

## Alternative: Use the Example HTML

Whisper.cpp comes with a working example. You can test it first:

```bash
cd whisper.cpp/examples/whisper.wasm

# Build if you haven't
bash build.sh

# Copy your model
cp /path/to/ggml-tiny.en.bin .

# Start a server
python3 -m http.server 8080

# Open http://localhost:8080 in browser
# Test the example to ensure whisper.cpp works
```

Once you confirm the example works, copy `whisper.js` and `whisper.wasm` to this project.

## Understanding the Files

### whisper.js
- JavaScript wrapper generated by emscripten
- Loads and initializes the WASM module
- Provides JavaScript API to call C++ functions
- Exports `createWhisperModule()` function

### whisper.wasm
- Compiled WebAssembly binary
- Contains the actual Whisper C++ code
- Loaded automatically by whisper.js
- Must be in the same directory as whisper.js

### Model file (ggml-tiny.en.bin)
- Pre-trained Whisper model weights
- Different sizes available: tiny, base, small, medium, large
- English-only models are smaller (*.en.bin)
- Multi-language models are larger

## Model Options

| Model | Size | Memory | Speed | Accuracy |
|-------|------|--------|-------|----------|
| tiny.en | ~75 MB | ~390 MB | Fastest | Good |
| base.en | ~140 MB | ~500 MB | Fast | Better |
| small.en | ~465 MB | ~1.0 GB | Medium | Best |

For web use, **tiny.en** is recommended for the best balance.

## Next Steps

After setup:
1. Test Vosk engine to ensure basic functionality works
2. Switch to Whisper engine
3. Compare the accuracy and performance
4. Choose the engine that best fits your needs

## Need Help?

If you're still having issues:
1. Check the whisper.cpp repository: https://github.com/ggerganov/whisper.cpp
2. Look at `examples/whisper.wasm/README.md` in whisper.cpp
3. Check browser console for detailed error messages
4. Verify all files are served via HTTP (not file://)
